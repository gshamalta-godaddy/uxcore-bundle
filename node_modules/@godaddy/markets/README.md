# `@godaddy/markets`

Shared configuration library for market, language, and currency data across GoDaddy.

## Motivation

GoDaddy is an multi-national company. We operate in dozens of markets and make transactions is almost as many currencies. The purpose of this library is to provide a single, unified API for interacting with market data such as:

- IETF langauge codes (aka [BCP-47 Language tags])
- [ISO639] language codes
- [ISO 4217] currency codes (used in [`Intl.NumberFormat`])

## Installation

If your project is already integrated with the [node-virt Artifactory registry](https://github.secureserver.net/javascript/best-practices/blob/master/nodejs/using-npm-with-artifactory.md):

```sh
npm install --save @godaddy/markets
```

## Usage

### Market data

```js
import Markets from '@godaddy/markets';
const markets = new Markets();

// Get the list of all country data
console.dir(markets.getCountries());

// Get specific country info
console.dir(markets.getCountry('fr'));

// Get the set of all markets
console.dir(markets.getMarkets());

// Get the list of all market names
console.dir(markets.getMarketNames());

// Get a specific market
console.dir(markets.getMarket('en-US'));

// Get VAT info on a specific market
console.log(markets.isVATIncluded('en-IE'));

// Get the fallback market when country is not known
console.log(Markets.fallbackMarketForLanguage('de'));
```

### Currency data

```js
import { getCurrencies } from '@godaddy/markets';

// Get the set of all currencies from GoDaddy's GUI service
getCurrencies('https://gui.godaddy.com', function (err, currencies) {
  if (err) { /* TODO: handle me */ }
  console.dir(currencies);
});
```

## API Documentation

### getCountries

Get the list of countries.

- Returns: Object

### getCountriesFromData

Get the list of countries given pre-loaded markets data (useful to avoid making additional calls to the API when you already have
the needed data).

### getCountry

Get information about a specific country by country code
- Param: code
- Returns: Object

| Property | Type | Description |
| --- | --- | --- |
| countryName | Either a string representing country name, or an object keyed by language with country names |
| countrySite | Subdomain of godaddy.com, generally the country code |
| languages | An object of support languages for the country, keyed by language, with value being a string representing the language name |
| primaryLanguage | The primary language for the country |
| currency | The default currency for the country |

Example:

```js
{
  countryName: {
    en: "United States",
    es: "Estados Unidos"
  },
  countrySite: "www",
  currency: "USD",
  languages: {
    en: "English",
    es: "EspaÃ±ol"
  },
  primaryLanguage: "en"
}
```

### getMarketNames

Get a list of market names
- Returns: Array

### getMarkets

Get a list of all market info
- Param: market
- Returns: Object (keyed by market name)

### getMarket

Get market info for a specific market
- Returns: Object

| Property | Type | Description |
| --- | --- | --- |
| market | Market name |
| countrySite | Subdomain for the country, typically country code |
| countryName | Localized string representing country name |
| currency | The default currency for the country |
| countryCode | Country code, always lowercased |
| languageCode | Language code, always lowercased |
| languageName | Localized string representing the language name |
| primaryLanguageForCountry | Boolean whether this is the primary language for the country |
| isRTL | Whether market reads right to left |

Example:

```js
{
  countrySite: "www",
  countryName: "United States",
  currency: "USD",
  market: "en-US",
  countryCode: "us",
  languageCode: "en",
  languageName: "English",
  primaryLanguageForCountry: true,
  isRTL: false
}
```

### (static) fallbackMarketForLanguage

Gets the fallback market code when only a language is known
- Param: language
- Returns: String

### isVATIncluded

Gets whether the specified market has VAT included in its prices
- Param: market
- Returns: `true` if VAT is included, `false` if VAT is explicitly excluded, `undefined` otherwise

### getCurrencies

Gets an ordered list of currencies asynchronously by calling GUI service
- Param: guiUrl
- Param: currentCurrency (optional, default USD)
- Param: callback (called with `err`, `currencies`)

## Using with webpack or another packager

If you use webpack or some other packager, you will need a json loader. Here is how you set that up for webpack:

``` bash
npm install --save json-loader
```

And then add this into your webpack.config.js file:

```js
module: {
  loaders: [
    { test: /\.json$/, loader: 'json' }
  ]
}
```

## Tests

```sh
npm test
```

> _Attribution: this library is originally based on data pulled from [@expresso/expresso-market](https://github.secureserver.net/expresso/expresso-market)._

[BCP-47 Language tags]: https://tools.ietf.org/html/rfc5646
[ISO639]: https://en.wikipedia.org/wiki/ISO_639
[ISO 4217]: https://en.wikipedia.org/wiki/ISO_4217
[`Intl.NumberFormat`]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/NumberFormat
