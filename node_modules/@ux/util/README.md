# UXCore2 utilities

Collection of utilities required for uxcore2 to work with cookies, storage and other browser API's.

### Installing

To install `@ux/util` as dependency of your project run.

```bash
npm install --save @ux/util
```

### Using utilities

Utility functions are exposed on the `ux` global. For a complete reference see the [API below](#api). Functions are available through the property `utils` on `ux`. For example:

```js
ux.utils.cookie.get('info_idp');
```

However, directly depending on `@ux/util` is preferred. WebPack or other build systems can [externalize the `import` and resolve to `ux.utils`](https://github.secureserver.net/uxcore2/uxcore2#building-client-js-assets). This improves local testability.

```js
import utils from '@ux/util';

let authInfo = utils.cookie.get('info_idp');
```

### API

All code examples assume `@ux/util` is imported to the variable `utils`.

#### utils.cookie

Read and set cookie values. This is a transparent pass-through of [koekiemonster] forked from [cookie-monster].

##### cookie.get

Get cookie value.

**param**: name {String} name of cookie.<br>
**returns**: value {String} decoded value.

```js
utils.cookie.get('cookie name');
```

##### cookie.set

Set cookie value.

**param**: name {String} name of cookie.<br>
**param**: value {String} mixed values, will be encoded.<br>
**param**: options {Object} Additional options, i.e. expiration time.<br>
**returns**: value {String} encoded value.

```js
utils.cookie.set('cookie name', 'value', {
  expires
  domain
  secure
  path
});
```

##### cookie.remove

Remove cookie value. Alternatively you can use `.set()` with `{ expires: new Date(0) }` option to unset a cookie.

**param**: name {String} name of cookie.<br>

``` js
utils.cookie.remove('cookie name');
```

#### utils.diagnostics

Write opt-in console debug/log messages.

##### diagnostics.debug

Create new scoped logger.

**param**: name {String} name of logger.<br>
**returns**: logger {Function} instance.

```js
const log = diagnostics.debug('namespace');

log('Message will be written to console if browser url has hashtag #debug=namespace')
```

#### utils.json

Safe JSON parse and stringify.

##### json.stringify

Stringify object, for more details see [mdn](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify). Method passes all arguments to native function.

```js
json.stringify({ hello: 'world' }, null, 2);
```

##### json.parse

Parse stringified object, for more details see [mdn](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse). Method passes all arguments to native function.

```js
json.parse('{"hello":"world"}');
```

#### utils.storage

**Deprecated: use [window.sessionStorage][sessionStorage] directly.**

Alias for `window.sessionStorage` (with the same API â€“ [sessionStorage])
when `window` is defined in the environment.

#### utils.request

Perform XHR requests. Uses [requests](https://github.com/unshiftio/requests) internally,
options for each request map 1:1 to [requests usage](https://github.com/unshiftio/requests#usage).
If the returned content is valid JSON it will be parsed to an object.

##### request.get

GET request.

**param**: url {String} target url.<br>
**param**: options {Object} Optional configuration.<br>
**param**: function {Function} Completion callback.

```js
utils.request.get('http://localhost:8080', {}, (error, content) => {});
```

##### request.post

POST request.

**param**: url {String} target url.<br>
**param**: data {Object} Data to send.<br>
**param**: options {Object} Optional configuration.<br>
**param**: function {Function} Completion callback.

```js
utils.request.post('http://localhost:8080', { my: 'data' }, {}, (error, content) => {});
```

#### utils.URL

Generate url's. Uses [url-parse](https://www.npmjs.com/package/url-parse) internally.

##### Usage

Create new url.

**param**: url {String} a string representing a url.<br>
**returns**: url {Object} instance.

```js
const url = new utils.URL('http://www.godaddy.com');
```

##### URL.set

Change parts of the url.

**param**: key {String} the property of the url that you want to change.<br>
**param**: value {String} the property of the url that you want to change. One of:<br>
`protocol`: The protocol scheme of the URL (e.g. http:).<br>
`slashes`: A boolean which indicates whether the protocol is followed by two forward slashes (//).<br>
`auth`: Authentication information portion (e.g. username:password).<br>
`username`: Username of basic authentication.<br>
`password`: Password of basic authentication.<br>
`host`: Host name with port number.<br>
`hostname`: Host name without port number.<br>
`port`: Optional port number.<br>
`pathname`: URL path.<br>
`query`: Parsed object containing query string, unless parsing is set to false.<br>
`hash`: The "fragment" portion of the URL including the pound-sign (#).<br>
`href`: The full URL.<br>
`origin`: The origin of the URL.<br>
**returns**: url {Object} instance with updated properties

```js
url.set('pathname', `${url.pathname}/foo`)
  .set('query', {
    bar: foobar,
    baz: barfoo
  });
```

### Testing

Make sure all dependencies are installed and that your using at least `node@4`.

```bash
npm test
```
[koekiemonster]: https://github.com/3rd-Eden/koekiemonster
[cookie-monster]: https://github.com/kahnjw/cookie-monster
[sessionStorage]: https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage
