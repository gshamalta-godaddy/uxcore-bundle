#!/usr/bin/env node

const uxcore2 = require('../../../bundles/uxcore2/lib');
const path = require('path');
const { writeFile } = require('fs').promises;

//
// Set of reserved properties that will follow a forced alternative naming convention
// under the ux namespace.
//
const reserved = {
  Pivots: '@ux/pivot',
  utils: '@ux/util',
  request: '@godaddy/request',
  Criteria: '@ux/form-element/criteria',
  Password: '@ux/form-element/password',
  Checkbox: '@ux/form-element/checkbox',
  QuantitySelector: '@ux/form-element/quantityselector',
  Radio: '@ux/form-element/radio',
  Search: '@ux/form-element/search',
  TelephoneInput: '@ux/form-element/telephone-input',
  Tooltip: '@ux/tooltip-legacy',
  Pagination: '@ux/pagination-legacy'
};

//
// Generate the externals from the exported modules of uxcore2.
//
const externals = Object.keys(uxcore2).sort().reduce(function reduce(memo, name) {
  const mod = name in reserved ? reserved[name] : `@ux/${ name.split(/(?=[A-Z])/).join('-').toLowerCase() }`;
  memo[mod] = {
    root: ['ux', name],
    commonjs: [mod, 'default'],
    commonjs2: [mod, 'default'],
    amd: mod
  };

  return memo;
}, {});

(async function () {
  await writeFile(path.join(__dirname, '..', 'externals.json'), JSON.stringify(externals, null, 2) + '\n');
}());
