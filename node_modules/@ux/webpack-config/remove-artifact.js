const path = require('path');
const fs = require('fs');

/**
 * Remove JS ouput after webpack has finished its compilation.
 *
 * @public
 */
class RemoveJSArtifact {
  /**
   * Plugin hook that runs when Webpack is done compiling
   *
   * @param {Stats} compiler stats and properties
   * @private
   */
  apply(compiler) {
    compiler.hooks.done.tapAsync('removeJSOutput', ({ compilation }, done) => {
      const { path: dist } = compilation.outputOptions;

      //
      // Use of this plugin requires not specifying a `output.filename` (which defaults to `[name].js`)
      //
      fs.unlink(path.join(dist, 'main.js'), done);
    });
  }
}

module.exports = RemoveJSArtifact;
